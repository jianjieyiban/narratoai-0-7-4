#!/usr/bin/env python
# -*- coding: UTF-8 -*-

"""
@Project: NarratoAI
@File   : frame_analysis.py
@Author : viccy同学
@Date   : 2025/1/7
@Description: 纪录片视频帧分析提示词
"""

from ..base import VisionPrompt, PromptMetadata, ModelType, OutputFormat


class FrameAnalysisPrompt(VisionPrompt):
    """纪录片视频帧分析提示词"""
    
    def __init__(self):
        metadata = PromptMetadata(
            name="frame_analysis",
            category="documentary",
            version="v1.0",
            description="分析纪录片视频关键帧，提取画面内容和场景描述",
            model_type=ModelType.VISION,
            output_format=OutputFormat.JSON,
            tags=["纪录片", "视频分析", "关键帧", "画面描述"],
            parameters=["video_theme", "custom_instructions"]
        )
        super().__init__(metadata)
        
        self._system_prompt = "你是一名专业的视频内容分析师，擅长分析纪录片视频帧内容，提取关键信息和场景描述。"
        
    def get_template(self) -> str:
        return """请仔细分析这些视频关键帧图片，我需要你提供详细的画面分析。

视频主题：${video_theme}

**关键要求**：
你必须准确识别画面中的实际内容，不能虚构或猜测。画面中有什么就描述什么，画面中没有的绝对不能描述。

分析要求（参考2025年热门博主标准）：
1. **按时间顺序分析每一帧画面**，确保连贯性
2. **详细描述画面中的主要内容**（必须基于实际画面，严禁虚构）：
   - **动物识别**：观察毛色、花纹、体型、耳朵、尾巴等显著特征来判断动物类型。如无法确认物种，可描述为“背部有条纹的小型啮齿动物”“灰褐色的大型猫科动物”等，切勿凭经验写成“小猪”“小狗”等固定角色
   - **人物识别**：如果是人物，描述动作、神态、表情、姿态
   - **物体识别**：准确识别物体类型、位置、状态、变化
   - **环境识别**：准确描述具体地点（如：室内客厅、厨房、农场、草原等）、时间背景、氛围
   - **行为识别**：准确描述实际行为（如：吃食、进食、喝水、看电视、烹饪等），不能虚构
3. **注意画面的构图、色彩、光线等视觉元素**：
   - 构图特点：特写、全景、对比等
   - 色彩氛围：温暖、冷峻、紧张等
   - 光线效果：明暗对比、氛围营造
4. **识别画面中的关键动作或变化**：
   - 动态细节：捕捉0.5秒的关键动作帧
   - 情绪变化：识别角色情绪的微妙变化
   - 视觉冲击点：识别具有视觉冲击力的名场面
5. **提供准确的时间戳信息**，精确到毫秒
6. **识别潜在的剪辑提示**：
   - 高能片段：适合开场的视觉冲击画面
   - 细节特写：适合放慢语速仔细解读的画面
   - 留白时机：适合精简文案或留白的画面

${custom_instructions}

请按照以下JSON格式输出分析结果：

{
  "analysis": [
    {
      "timestamp": "00:00:05,390",
      "picture": "详细的画面描述，包括场景、人物、物体、动作等",
      "scene_type": "场景类型（如：建造、准备、完成、冲突、情感爆发等）",
      "key_elements": ["关键元素1", "关键元素2"],
      "visual_quality": "画面质量描述（构图、光线、色彩等）",
      "clip_hint": "剪辑提示（如：高能开场、细节特写、留白时机、情绪爆发点等）",
      "emotion": "画面情绪（紧张、温馨、震撼、幽默等）",
      "action_highlight": "动作亮点（0.5秒关键动作描述，适合开场使用）"
    }
  ],
  "summary": "整体视频内容概述",
  "total_frames": "分析的帧数"
}

重要要求（严格遵守）：
1. 只输出JSON格式，不要添加任何其他文字或代码块标记
2. 画面描述要详细准确，为后续解说文案生成提供充分信息
3. 时间戳必须准确对应视频帧
4. **严禁虚构不存在的内容**：画面中有什么就描述什么，画面中没有的绝对不能描述
5. **准确识别内容类型**：
   - 如果是动物（如猪、狗、猫、鸡等），必须准确识别并描述
   - 如果是人物，必须准确描述人物的实际动作和行为
   - 如果是室内场景（客厅、厨房等），必须准确描述，不能描述为"草原"、"森林"等
   - 如果是进食行为，必须准确描述为"进食"、"吃食"等，不能描述为"捕食"、"觅食"等野生动物行为
6. **画面描述必须客观真实**：不能因为模板、经验或既有脚本而杜撰场景
   - 例如：画面是条纹背、蓬松尾巴的小型动物在树桩啃坚果，就描述“条纹背小型啮齿动物在树桩啃坚果”，不要写成“小猪在食盆吃饲料”
   - 如果画面是男子在客厅拿水杯，就描述"男子在客厅拿水杯"
   - 绝对不能将室内/都市/树林等画面写成"非洲草原"、"狮子"之类的野外场景
   - 绝对不能将人物行为描述为动物行为
"""
