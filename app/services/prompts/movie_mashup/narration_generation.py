#!/usr/bin/env python
# -*- coding: UTF-8 -*-

"""
@Project: NarratoAI
@File   : narration_generation.py
@Description: 影视混剪文案生成提示词
"""

from ..base import TextPrompt, PromptMetadata, ModelType, OutputFormat


class MovieMashupNarrationPrompt(TextPrompt):
    """影视混剪文案生成提示词"""

    def __init__(self):
        metadata = PromptMetadata(
            name="narration_generation",
            category="movie_mashup",
            version="v1.0",
            description="生成影视混剪视频解说文案，强调主题串联和情感共鸣，适合多部影片精彩片段合集",
            model_type=ModelType.TEXT,
            output_format=OutputFormat.JSON,
            tags=["影视混剪", "经典片段", "主题合集", "情感共鸣", "精华剪辑"],
            parameters=["video_frame_description"]
        )
        super().__init__(metadata)

        self._system_prompt = "你是一名专业的影视混剪创作者，参考'老高短剧燃剪'和'小巷里的'的成功经验，擅长从多部影片中提炼共同主题，用精炼有力的解说将不同作品的精彩瞬间串联成完整的情感体验，强调创意性和艺术性。"

    def get_template(self) -> str:
        return """作为影视混剪创作者，你需要创作既有主题深度又充满情感共鸣的解说文案。

<mashup_strategy>
## 影视混剪核心技巧

### 1. 主题定位
**常见主题方向**：
- **情感主题**：父爱、母爱、友情、爱情、师生情
- **励志主题**：坚持、梦想、逆境、成长、自由
- **人生主题**：选择、告别、救赎、希望、真相
- **视觉主题**：经典画面、名场面、泪点时刻、高燃片段

**主题表达要点**：
- 开篇点明主题
- 每个片段呼应主题
- 结尾升华主题

### 2. 开场设计
**钩子类型**：
- **排比开场**："他用XX告诉我们XX，他用XX证明了XX，他用XX..."
- **对比开场**："同样是XX，有人XX，有人XX"
- **疑问开场**："什么才是真正的XX？这些电影给出了答案"
- **情感开场**："有些瞬间，足以感动一生"

**3秒法则**：
- 快速点题，不拖泥带水
- 情绪饱满，带入感强
- 画面精彩，视觉冲击

### 3. 片段串联技巧
**过渡衔接**：
- 主题呼应："同样的XX，不同的XX"
- 情感递进："如果说这是XX，那么这就是XX"
- 对比并列："XX告诉我们XX，而XX则XX"
- 时间穿越："从XX到XX，从XX到XX"

**节奏控制**：
- 长短搭配：长片段深度解读，短片段快速点睛
- 张弛有度：激昂处饱满，温情处舒缓
- 情绪曲线：起承转合，层层推进

### 4. 解说要点（参考"老高短剧燃剪"的燃剪技法）
**燃剪策略**：
- 选取节奏明快、情节高潮的片段
- 运用快速剪辑的手法，搭配激昂的音乐
- 不仅阐述剧情脉络，还对人物性格、情感进行深入剖析

**精准提炼**：
- 每个片段1-2句话（12-20字），精炼有力
- 抓住核心情感或行动
- 避免冗长的背景介绍

**金句打造**：
- 提炼台词精华，创造记忆点
- 引发情感共鸣，多用排比、对比等修辞手法
- 适当引用或改编经典台词

**留白艺术**：
- 经典画面适当留白，让画面自己说话
- 关键台词保留原声（OST=1），增强感染力
- **变速艺术**：激昂处饱满，温情处舒缓

### 5. 结尾升华
**总结提升**：
- 回扣主题
- 情感升华
- 引发思考

**互动收束**：
- "这就是电影的力量"
- "哪部最打动你？"
- "记得点赞关注，下期更精彩"

## 语言风格
- **简洁有力**：每句话都是精华，没有废话
- **情感饱满**：用词要有温度和力量
- **节奏明快**：短句为主，韵律感强
- **金句频出**：可引用或改编经典台词
- **主题贯穿**：始终围绕主题展开
</mashup_strategy>

<video_frame_description>
$${video_frame_description}
</video_frame_description>

现在，请基于 <video_frame_description> 中的影视片段，创作混剪解说文案。

<creation_requirements>
**必须包含的要素：**
1. **开场**：主题点明 + 情感基调设定
2. **片段解说**：每个影片片段1-2句精炼解说
3. **过渡衔接**：片段间自然流畅的连接
4. **情感递进**：从浅入深，层层推进
5. **结尾升华**：主题总结 + 情感共鸣
6. **互动收束**：引导评论和关注

**解说特点（自媒体标准）**：
- **字数控制**：根据时间戳计算，每0.3-0.35秒一个字（约每分钟200字语速），每个片段解说控制在12-20字
- **单句长度**：控制在12-18字，避免超长句子
- **节奏感**：短句为主，快节奏推进，每分钟200-250字语速
- 多使用排比、对比等修辞手法，增强感染力
- 适当引用或改编经典台词，但要用口语化表达
- 情感词汇丰富，有感染力，多用"真的"、"太XX了"、"简直"等网络用语
- 避免过多剧情解释，突出情感和主题，每个片段1-2句精炼解说

**主题把控**：
- 确保每个片段都扣住主题
- 不同片段间要有层次和递进
- 避免简单罗列，要有逻辑线索
- 结尾要有超越个别电影的深度

**避免：**
- 过度解释剧情背景
- 片段间缺乏连贯性
- 主题涣散，没有中心
- 情感表达空洞无力
</creation_requirements>

请使用以下 JSON 格式输出：

{
  "items": [
    {
        "_id": 1,
        "timestamp": "00:00:00,000-00:00:05,500",
        "picture": "画面描述",
        "narration": "解说文案"
    }
  ]
}

注意事项（严格遵守）：
1. 只输出 JSON 内容，不要输出其他任何说明性文字、代码块标记或解释
2. 解说文案使用简体中文，必须口语化，像日常聊天
3. **严禁虚构画面**：所有画面描述必须严格从上述视频帧描述中提取，不能添加任何视频中没有的内容
4. **严禁虚构时间戳**：所有时间戳必须严格从上述视频帧描述中提取
5. **画面与解说必须完全匹配**：解说的内容必须与picture字段描述的画面完全一致。如果画面描述的是非影视内容（如生活场景、动物等），绝对不能生成影视混剪相关的内容。必须严格基于实际画面内容生成解说
6. **类型验证**：如果视频帧描述中没有任何影视相关内容（如：没有演员、没有剧情画面、没有电影场景），即使选择了影视混剪模板，也必须生成与画面匹配的解说，不能强行生成影视混剪相关的内容
7. **开头前3秒**：必须点明主题，设定情感基调，禁止平淡开场，必须制造钩子
8. **字数控制**：根据时间戳计算，每0.3-0.35秒一个字（约每分钟200字语速），例如5.5秒片段约16-18字
9. **单句长度**：控制在12-18字，避免超长句子
10. 每个片段解说要精炼有力（1-2句），扣住主题，避免冗长（仅在画面中确实有影视片段时）
11. 片段间过渡要自然流畅，用"同样是"、"如果说"、"而XX则"等连接
12. 多使用排比、对比等修辞手法，增强感染力
13. 结尾要有主题升华和自然互动："这就是电影的力量"、"哪部最打动你？"、"记得点赞关注"
14. **禁止书面语**：避免"因此"、"然而"、"此外"等正式词汇，改用"所以"、"但是"、"还有"
15. OST建议设置为0（纯AI配音），或在经典台词处设为1保留原声
16. **验证检查**：生成后检查每个片段的narration是否与对应的picture描述的内容匹配，如果出现不匹配（如画面是生活场景但解说是影视内容），必须重新生成
"""
