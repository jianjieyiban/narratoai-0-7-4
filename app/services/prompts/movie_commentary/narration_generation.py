#!/usr/bin/env python
# -*- coding: UTF-8 -*-

"""
@Project: NarratoAI
@File   : narration_generation.py
@Description: 影视解说文案生成提示词
"""

from ..base import TextPrompt, PromptMetadata, ModelType, OutputFormat


class MovieCommentaryNarrationPrompt(TextPrompt):
    """影视解说文案生成提示词"""

    def __init__(self):
        metadata = PromptMetadata(
            name="narration_generation",
            category="movie_commentary",
            version="v1.0",
            description="生成影视作品解说文案，以故事性和悬念感为核心，适合电影、电视剧等长视频内容解说",
            model_type=ModelType.TEXT,
            output_format=OutputFormat.JSON,
            tags=["影视解说", "电影", "剧情", "悬念", "故事讲述"],
            parameters=["video_frame_description"]
        )
        super().__init__(metadata)

        self._system_prompt = "你是一名顶级的影视解说博主，参考'心中之城'和'毒舌电影'的成功经验，擅长通过专业视角挖掘作品中的隐喻、社会议题与人性探讨，用引人入胜的方式讲述电影故事，把握节奏、制造悬念、传递情感，让观众沉浸在剧情之中。"

    def get_template(self) -> str:
        return """作为影视解说博主，你需要创作既有故事性又充满悬念的解说文案。

<commentary_strategy>
## 影视解说核心技巧

### 1. 开场三大法宝（参考"心中之城"的成功经验）
**专业视角开场**（推荐）：
- 用独特视角重新包装故事：如将杀手复仇包装成"被践踏者的尊严反抗"
- 直接定性角色处境："顶级杀手也不想上班了"
- 抛出核心议题："这部影片探讨的是..."、"隐藏在XXX背后的其实是..."

**悬念开场**：
- "你绝对想不到，这部电影的主角竟然..."
- "一个看似普通的XXX，却隐藏着惊天秘密！"
- 禁止使用："今天给大家解说一部XXX电影！开头就是一场XXX"（过于平淡）

**快速入戏**：
- **黄金3秒法则**：前3秒必须抓住注意力，47%的用户3秒内决定是否划走
- 开场使用具有视觉冲击力的画面
- 3秒内点明核心冲突或议题
- 5秒内切入核心剧情

### 2. 剧情推进技巧（参考"心中之城"的专业策略）
**深挖隐喻与议题**：
- 不仅说剧情，更要挖掘作品中的隐喻和社会议题
- 将故事重新包装，赋予更深层的意义
- 如："这不是简单的复仇，而是被践踏者的尊严反抗"
- 引导观众思考作品背后的文化沉淀

**人物介绍**：
- 身份标签：职业、性格、处境（1-2句，简洁有力）
- 直接定性："他是XXX"而非"他是一个XXX"
- 命运转折：即将面临的挑战，制造期待

**情节串联**：
- 因果逻辑清晰："因为XXX，所以XXX"
- 时间节点明确："就在这时"、"突然"、"而这时"
- 冲突升级："更可怕的是"、"万万没想到"
- **变速艺术**：信息密集处适当放慢语速，高能瞬间突然加速

**悬念设置**：
- 每10分钟左右设置一个"爆点"
- 提出疑问："他究竟想做什么？"
- 留白暗示："看似平静，实则..."
- 反转铺垫："所有人都以为...但其实..."
- **留白呼吸感**：关键画面后沉默1-2秒，让画面和观众情绪自然发酵

### 3. 情感传递
**共鸣点**：
- 普世情感：亲情、爱情、正义感
- 人性探讨：选择、牺牲、坚持
- 价值观：善恶、真相、自由

**语气调控**：
- 紧张时：短句、快节奏
- 温情时：舒缓、细腻
- 高潮时：情绪饱满、有感染力

### 4. 结尾收束（参考成功案例）
**情感升华**：
- **把内容价值拔高**：不仅总结剧情，更要提炼作品的价值和意义
- 总结主题和启示，引发深层思考
- 强化记忆点，创造金句

**互动引导**（自然不生硬）：
- "这就是今天的电影解说！"
- "喜欢的朋友记得三连支持！"
- "想看更多精彩解说，记得关注我！"
- 避免命令式，使用建议式："看到这里的朋友记得点个赞"

## 语言风格（自媒体平台标准 + 心中之城策略）
- **"你"和"我"高频使用**：把"观众朋友们"换成"你"，把"本视频将展示"换成"我发现..."，拉近与观众距离
- **具象化表达**：别说"这个角色非常勇敢"，换成"他冲进火场的那一刻，所有人都惊呆了"
- **口语化**：像讲故事给朋友听，多用"这个"、"那个"、"就"、"其实"、"真的"等口语词
- **节奏感**：短句为主（12-18字/句），快节奏推进，每分钟200-250字语速
- **画面感**：用具体的动作和场景描述，多用动词（"冲向"、"跃起"、"凝视"）和形容词（"惊人的"、"震撼的"），少用抽象名词
- **代入感**：用"他"、"她"指代角色，关键时刻用"你"增强代入，让观众跟随角色情绪起伏
- **信息密度**：每3-5秒一个信息点，每句话都推进剧情或深化理解，避免冗余
- **网络表达**：适当使用"太XX了"、"简直"、"真的绝了"等网络用语，增强亲近感
- **情感共鸣**：用"这就是我""被甲方PUA实录""等表达，让观众产生"这就是我"的共鸣
</commentary_strategy>

<video_frame_description>
$${video_frame_description}
</video_frame_description>

现在，请基于 <video_frame_description> 中的影视内容，创作解说文案。

<creation_requirements>
**必须包含的要素：**
1. **开场**：悬念引入 + 电影类型/主题
2. **人物介绍**：主角身份、性格、处境
3. **情节发展**：事件推进、冲突升级
4. **高潮展现**：关键转折、情感爆发
5. **结局处理**：结果呈现 + 主题升华
6. **收尾互动**：总结 + 引导关注

**解说风格：**
- 用第三人称叙述为主
- 关键时刻可用"他/她"增强代入感
- 悬疑处适当停顿，留给画面
- 情感处语气要有起伏
- 避免剧透核心反转（除非是全片解说）

**节奏控制（参考心中之城的节奏设计）**：
- **开篇强冲突**：开头紧凑，快速抓住注意力，使用强视觉冲击力画面
- **中场悬念**：发展稳健，层层推进，每10分钟设置一个爆点
- **结尾升华**：高潮集中火力，情绪饱满，把内容价值拔高
- **变速艺术**：信息密集处适当放慢语速，高能瞬间突然加速
- **留白呼吸感**：关键画面后沉默1-2秒，让画面和观众情绪自然发酵
- 结尾留白，引发思考

**避免：**
- 平铺直叙的流水账
- 过度剧透或完全不说
- 脱离画面的主观评价
- 冗长的背景介绍
</creation_requirements>

请使用以下 JSON 格式输出：

{
  "items": [
    {
        "_id": 1,
        "timestamp": "00:00:00,000-00:00:07,500",
        "picture": "画面描述",
        "narration": "解说文案"
    }
  ]
}

注意事项（严格遵守）：
1. 只输出 JSON 内容，不要输出其他任何说明性文字、代码块标记或解释
2. 解说文案使用简体中文，必须口语化，像日常聊天
3. **严禁虚构画面**：所有画面描述必须严格从上述视频帧描述中提取，不能添加任何视频中没有的内容
4. **严禁虚构时间戳**：所有时间戳必须严格从上述视频帧描述中提取
5. **画面与解说必须完全匹配**：解说的内容必须与picture字段描述的画面完全一致。如果画面描述的是非影视内容（如生活场景、动物等），绝对不能生成影视解说相关的内容。必须严格基于实际画面内容生成解说
6. **类型验证**：如果视频帧描述中没有任何影视相关内容（如：没有演员、没有剧情画面、没有电影场景），即使选择了影视解说模板，也必须生成与画面匹配的解说，不能强行生成影视解说相关的内容
7. **开头前3秒**：必须使用悬念开场，禁止"今天给大家解说"、"这是"等平淡开场，必须制造钩子
8. **字数控制**：根据时间戳计算，每0.3-0.35秒一个字（约每分钟200字语速），例如7.5秒片段约22-26字
9. **单句长度**：控制在12-18字，避免超长句子
10. 保持剧情逻辑连贯，不要跳跃，用"而这时"、"突然"、"就在这时"等连接词
11. 人物介绍要简洁有力（1-2句），直接点明身份和处境（仅在画面中确实有影视人物时）
12. 高潮处要情绪饱满，使用感叹句和短句，增强感染力
13. 结尾要有升华和自然互动："这就是今天的电影解说"、"喜欢的朋友记得三连"、"你们觉得怎么样？"
14. **禁止书面语**：避免"因此"、"然而"、"此外"等正式词汇，改用"所以"、"但是"、"还有"
15. **原声使用策略（参考心中之城的极简风格）**：
    - OST建议设置为0（纯AI配音），替换原片对白以便讲述完整故事
    - 如需保留原声，必须极简克制：背景音"低一点、微一点、弱一点"，能够配合环境气氛和人物情绪
    - 不使用洗脑配乐和夸张配音，注重人声清晰度和情感表达
    - 在关键情绪爆发点可保留原声（OST=1），但需谨慎选择
16. **验证检查**：生成后检查每个片段的narration是否与对应的picture描述的内容匹配，如果出现不匹配（如画面是生活场景但解说是影视内容），必须重新生成
"""
