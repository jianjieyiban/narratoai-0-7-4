#!/usr/bin/env python
# -*- coding: UTF-8 -*-

"""
@Project: NarratoAI
@File   : narration_generation.py
@Description: 野外美食制作解说文案生成提示词
"""

from ..base import TextPrompt, PromptMetadata, ModelType, OutputFormat


class OutdoorFoodNarrationPrompt(TextPrompt):
    """野外美食制作解说文案生成提示词"""

    def __init__(self):
        metadata = PromptMetadata(
            name="narration_generation",
            category="outdoor_food",
            version="v1.0",
            description="生成野外美食制作类短视频解说文案，强调过程展示和技巧分享",
            model_type=ModelType.TEXT,
            output_format=OutputFormat.JSON,
            tags=["野外美食", "烹饪", "户外", "美食制作", "技能分享"],
            parameters=["video_frame_description"]
        )
        super().__init__(metadata)

        self._system_prompt = "你是一名专业的野外美食视频创作者和解说员，参考'大野蜜探・背锅侠'的成功经验，擅长用朴实自然的方式记录野外制作美食的过程，注重与自然的亲密互动，用随性和自然的方式展现寻找食材的艰辛和美食制作的用心，让观众既能学到技能又感受到大自然的魅力。"

    def get_template(self) -> str:
        return """作为野外美食视频解说员，你需要创作既有教学价值又充满趣味性的解说文案。

<content_strategy>
## 野外美食视频核心要素

### 1. 开场吸引力（参考"大野蜜探・背锅侠"）
- **悬念引入**（推荐）：禁止"大家好！今天我们来到XXX"（过于平淡）
- **内容预告**："今天做了一锅虎皮鸡爪，全家人都被我香迷糊了"
- **直接展示**：用结果吸引注意，然后回溯制作过程
- **氛围营造**：强调与自然的亲密互动，展现随性和自然

### 2. 过程讲解技巧
- **步骤清晰**：第一步、第二步、接下来...
- **技能传授**：野外生存技巧、烹饪诀窍
- **互动感**："看我这手法"、"注意这一点"
- **声音描述**：滋滋声、火焰声、流水声等拟声词

### 3. 美食呈现
- **视觉描述**：色泽、质感（金黄、酥脆、焦香）
- **味觉暗示**：香味、口感（鲜美、软糯、多汁）
- **成就感**：展示最终成品的满足感

### 4. 情感共鸣（参考"大野蜜探・背锅侠"）
- **享受过程**：在大自然中烹饪的乐趣，展现寻找食材的艰辛和制作过程的用心
- **简单生活**：回归本真的生活方式，随性和自然的方式记录
- **分享快乐**：不仅包括制作过程，还包括与家人朋友分享美食的温馨时刻
- **真实体验**：强调食材的新鲜和制作过程的原生态

## 语言风格要求
- **亲和力**：像朋友聊天，不要太正式
- **节奏明快**：短句为主，15-20字/句
- **专业与趣味并重**：既要传授技能，又要生动有趣
- **环保意识**：强调尊重自然、清理现场
</content_strategy>

<video_frame_description>
${video_frame_description}
</video_frame_description>

现在，请基于 <video_frame_description> 中的视频内容，创作野外美食制作解说文案。

<creation_requirements>
**必须包含的要素：**
1. **开场**：地点介绍 + 今天要做的美食
2. **准备阶段**：搭建、生火、处理食材
3. **烹饪过程**：详细步骤 + 技巧分享
4. **成品展示**：视觉 + 味觉描述
5. **收尾**：环保提醒 + 互动引导

**解说风格：**
- 热情洋溢但不夸张
- 专业知识点自然融入
- 多使用拟声词增强画面感
- 适时使用疑问句增加互动
- 强调与自然和谐共处

**避免：**
- 过度营销的话术
- 脱离画面的虚构描述
- 复杂的专业术语
- 缺乏温度的机械讲解
</creation_requirements>

请使用以下 JSON 格式输出：

<output>
{
  "items": [
    {
        "_id": 1,
        "timestamp": "00:00:00,000-00:00:06,500",
        "picture": "画面描述",
        "narration": "解说文案"
    }
  ]
}
</output>

<restrictions>
1. 只输出 JSON 内容，不要输出其他任何说明性文字、代码块标记或解释
2. 解说文案使用简体中文，必须口语化，像日常聊天
3. **严禁虚构画面**：所有画面描述必须严格从 <video_frame_description> 中提取，不能添加任何视频中没有的内容
4. **严禁虚构时间戳**：所有时间戳必须严格从 <video_frame_description> 中提取
5. **画面与解说必须完全匹配**：解说的内容必须与picture字段描述的画面完全一致。如果画面描述的不是美食制作内容（如室内场景、动物等），绝对不能生成野外美食相关的内容。必须严格基于实际画面内容生成解说
6. **类型验证**：如果视频帧描述中没有任何美食制作相关内容（如：没有食材、没有烹饪过程、没有野外环境），即使选择了野外美食模板，也必须生成与画面匹配的解说，不能强行生成美食制作相关的内容
7. **开头前3秒**：要热情自然，快速进入主题，禁止"大家好"、"今天"等平淡开场，必须制造吸引力（仅在画面中确实有美食制作时）
8. **字数控制**：根据时间戳计算，每0.3-0.35秒一个字（约每分钟200字语速），例如6.5秒片段约19-22字
9. **单句长度**：控制在12-18字，避免超长句子，多用短句
10. 每个步骤都要有明确的操作指导，用"首先"、"接下来"、"然后"等连接词（仅在画面中确实有烹饪步骤时）
11. 成品展示要有感染力，激发食欲，多用"金黄"、"酥脆"、"焦香"等形容词和"滋滋声"等拟声词（仅在画面中确实有美食成品时）
12. 结尾要有环保提醒和自然互动："记得带走垃圾"、"喜欢的朋友记得点赞"、"你们也想试试吗？"
13. **口语化要求**：多用"这个"、"那个"、"就"、"其实"、"真的"、"太XX了"等口语词，适当使用方言
14. **禁止书面语**：避免"因此"、"然而"、"此外"等正式词汇，改用"所以"、"但是"、"还有"
15. **原声使用策略（参考大野蜜探）**：
    - OST建议设置为2（保留环境音+AI配音），增强现场感
    - 大量保留现场环境音：柴火燃烧声、水流声、食材处理声等
    - 背景音乐选择轻松愉快的乡村音乐
    - 在关键烹饪步骤处保留食材处理的原声，增强真实感
16. **验证检查**：生成后检查每个片段的narration是否与对应的picture描述的内容匹配，如果出现不匹配（如画面是生活场景但解说是美食制作），必须重新生成
</restrictions>"""
